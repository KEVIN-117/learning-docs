## Redundancia en redes conmutadas de capa 2
La redundancia es una parte muy importante de diseño jerárquico lo cual permite eliminar puntos únicos de falla. Las redes redundantes requiere la adición de rutas físicas, pero las rutas redundantes en una red `Ethernet` puede causar bucles físicos y lógicos en la capa 2.

Las LAN Ethernet requieren una topología sin bucles con una única ruta entre dos dispositivos. Un bucle en una LAN Ethernet puede provocar una propagación continua de tramas Ethernet hasta que un enlace se interrumpe y interrumpa el bucle

## Protocolo de árbol de expansión
Es un protocolo de red de prevención de bucles que permite redundancia mientras crea una topología de capa 2 sin bucles

### STP Operación Normal
![[Pasted image 20241103090511.png]]
### Recalcular STP

![[Pasted image 20241103091011.png]]
## Problemas con los vínculos de switch redundantes
Cuando existen múltiples rutas entre dos dispositivos en una red Ethernet no hay implementación de #STP en los conmutadores dando paso a que se produzca un bucle de capa 2 provocando inestabilidad en la tabla de direcciones MAC, saturación de enlaces y alta utilización de CPU en conmutadores y dispositivos finales, lo que hace que la red se vuelva inutilizable.
A diferencia de los protocolos de Capa 3, IPv4 e IPv6, La capa 2 Ethernet no incluye un mecanismo para reconocer y eliminar tramas de bucle sin fin, a differentia de #IPv4 #IPv6 que si tienen un mecanismo que limita la cantidad de veces que un dispositivo de red de Capa 3 puede retransmitir un paquete
- Un router disminuirá la #TTL en cada paquete IPv4
- Un router disminuirá el campo limite de saltos en cada paquete IPv6
y Ethernet no tienen un mecanismo comparable para limitar el número de veces que un switches retransmite una trama de Capa 2. STP fue desarrollado específicamente como un mecanismo de prevención de bucles para Ethernet de Capa 2.
## Bucles de la capa 2
Sin #STP habilitado se producen bucles de capa 2, lo que hace que las tramas de #difusión, #multidifusión y #unidifusión_desconocidos se reproduzcan sin fin

![[Pasted image 20241103093811.png]]

## Tormenta de difusión (Broadcast Storm)

Las tormentas de difusión pueden deshabilitar una red en cuestión de segundos al abrumar los conmutadores y los dispositivos finales. Las tormentas de difusión pueden deberse a un problema de hardware como una NIC defectuosa o a un bucle de capa 2 en la red.
![[Pasted image 20241103094703.png]]

## El algoritmo de árbol de expansión
 pasos de como la #STP  crea una topología sin bucles.
 ![[Pasted image 20241103094918.png]]
  1. **Seleccionar el Root Bridge**: En esta topología, todos los enlaces tienen el mismo costo (mismo ancho de banda). Cada switch determinará una única ruta de menor costo desde sí mismo hasta el puente raíz.
	  <div class="tip-card">
        <div class="icon">💡</div>
        <div class="content">
             El puente raíz está determinado por el ID de puente más bajo, que consta del valor de prioridad y la dirección MAC. Debido a que los valores de prioridad de todos los switchs son idénticos, la dirección MAC se utiliza para determinar el puente raíz. Debido a que S2 tiene la dirección MAC más baja, S2 se convierte en el puente raíz.
        </div>
    </div>
  ![[Pasted image 20241103095003.png]]
  2.  **Bloquear rutas redundantes**: STP asegura que solo haya una ruta lógica entre todos los destinos en la red al bloquear intencionalmente las rutas redundantes que podrían causar un bucle
  ![[Pasted image 20241103095248.png]]
  3. **Topología sin bucle**: 
![[Pasted image 20241103095506.png]]
4. **Fallos de enlaces causan recálculo**: Las rutas físicas aún existen para proporcionar la redundancia, pero las mismas se deshabilitan para evitar que se generen bucles. Si alguna vez la ruta es necesaria para compensar la falla de un cable de red o de un switch, STP vuelve a calcular las rutas y desbloquea los puertos necesarios para permitir que la ruta redundante se active. Los recálculos STP también pueden ocurrir cada vez que se agrega un nuevo conmutador o un nuevo vínculo entre switches a la red.
![[Pasted image 20241103095632.png]]
## Packet Tracer - Investigar la prevención de bucles STP
En esta actividad de Packet Tracer, completará los siguientes objetivos:

- Cree y configure una red simple de tres conmutadores con STP.
- Ver operación STP
- Desactive STP y vuelva a ver la operación.
![[5.1.9-packet-tracer---investigate-stp-loop-prevention_es-XL.pka]]
[[5.1.9-packet-tracer---investigate-stp-loop-prevention_es-XL.pdf]]

## Verifique su comprensión - Propósito de STP

<div class="col-md-8 col-sm-12"><ol><li class="question-container"><span><div id="c9d12290-1c27-11ea-af09-3b2e6521927c" class="text-asset cyu-question" style="position: relative;"><p>¿Qué enunciado describe mejor STP?</p></div><div class="question question-correct"><span class="icon-check-outline icon-small status-icon"></span><span>¡Lo tienes!</span></div></span><div class="form-group answer" role="group" aria-label="option-id-c9d12291-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d12291-1c27-11ea-af09-3b2e6521927c-0-answer-0" class="radio" data-answer="incorrect"><input type="radio" name="question-0" id="question-option-id-c9d12291-1c27-11ea-af09-3b2e6521927c-0-answer-0" aria-label="option-id-c9d12291-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d12291-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d12291-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>STP es un protocolo de enrutamiento de capa 2.</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d12292-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d12292-1c27-11ea-af09-3b2e6521927c-0-answer-1" class="radio" data-answer="incorrect"><input type="radio" name="question-0" id="question-option-id-c9d12292-1c27-11ea-af09-3b2e6521927c-0-answer-1" aria-label="option-id-c9d12292-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d12292-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d12292-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>STP es un protocolo de enrutamiento de capa 3 para LAN Ethernet.</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d12293-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d12293-1c27-11ea-af09-3b2e6521927c-0-answer-2" class="radio" data-answer="correct"><input type="radio" name="question-0" id="question-option-id-c9d12293-1c27-11ea-af09-3b2e6521927c-0-answer-2" aria-label="option-id-c9d12293-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d12293-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d12293-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>STP es un protocolo de prevención de bucle de Capa 2 para LAN Ethernet.</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d149a0-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d149a0-1c27-11ea-af09-3b2e6521927c-0-answer-3" class="radio" data-answer="incorrect"><input type="radio" name="question-0" id="question-option-id-c9d149a0-1c27-11ea-af09-3b2e6521927c-0-answer-3" aria-label="option-id-c9d149a0-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d149a0-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d149a0-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>STP es un protocolo de prevención de bucle de capa 3 para redes IP.</p></div></span></label></div></li><li class="question-container"><span><div id="c9d149a1-1c27-11ea-af09-3b2e6521927c" class="text-asset cyu-question" style="position: relative;"><p>Sin STP en la LAN Ethernet, ¿qué tres tipos de tramas podrían causar un bucle catastrófico en la red? (Escoja tres opciones).</p></div><div class="question question-correct"><span class="icon-check-outline icon-small status-icon"></span><span>¡Lo tienes!</span></div></span><div class="form-group answer" role="group" aria-label="option-id-c9d149a2-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d149a2-1c27-11ea-af09-3b2e6521927c-1-answer-0" class="checkbox" data-answer="incorrect"><input type="checkbox" name="question-1" id="question-option-id-c9d149a2-1c27-11ea-af09-3b2e6521927c-1-answer-0" aria-label="option-id-c9d149a2-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d149a2-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="checkbox__input"></span><span class="checkbox__label"><div id="c9d149a2-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Unidifusión</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d170b0-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d170b0-1c27-11ea-af09-3b2e6521927c-1-answer-1" class="checkbox" data-answer="correct"><input type="checkbox" name="question-1" id="question-option-id-c9d170b0-1c27-11ea-af09-3b2e6521927c-1-answer-1" aria-label="option-id-c9d170b0-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d170b0-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="checkbox__input"></span><span class="checkbox__label"><div id="c9d170b0-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Unidifusión desconocida</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d170b1-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d170b1-1c27-11ea-af09-3b2e6521927c-1-answer-2" class="checkbox" data-answer="correct"><input type="checkbox" name="question-1" id="question-option-id-c9d170b1-1c27-11ea-af09-3b2e6521927c-1-answer-2" aria-label="option-id-c9d170b1-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d170b1-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="checkbox__input"></span><span class="checkbox__label"><div id="c9d170b1-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Multidifusión</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d170b2-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d170b2-1c27-11ea-af09-3b2e6521927c-1-answer-3" class="checkbox" data-answer="correct"><input type="checkbox" name="question-1" id="question-option-id-c9d170b2-1c27-11ea-af09-3b2e6521927c-1-answer-3" aria-label="option-id-c9d170b2-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d170b2-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="checkbox__input"></span><span class="checkbox__label"><div id="c9d170b2-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Difusión</p></div></span></label></div></li><li class="question-container"><span><div id="c9d170b3-1c27-11ea-af09-3b2e6521927c" class="text-asset cyu-question" style="position: relative;"><p>¿Qué dispositivo es elegido por el algoritmo de árbol de expansión al que todos los demás conmutadores determinan una única ruta de menor costo?</p></div><div class="question question-correct"><span class="icon-check-outline icon-small status-icon"></span><span>¡Lo tienes!</span></div></span><div class="form-group answer" role="group" aria-label="option-id-c9d197c0-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d197c0-1c27-11ea-af09-3b2e6521927c-2-answer-0" class="radio" data-answer="correct"><input type="radio" name="question-2" id="question-option-id-c9d197c0-1c27-11ea-af09-3b2e6521927c-2-answer-0" aria-label="option-id-c9d197c0-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d197c0-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d197c0-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Root bridge (Puente raíz)</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d197c1-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d197c1-1c27-11ea-af09-3b2e6521927c-2-answer-1" class="radio" data-answer="incorrect"><input type="radio" name="question-2" id="question-option-id-c9d197c1-1c27-11ea-af09-3b2e6521927c-2-answer-1" aria-label="option-id-c9d197c1-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d197c1-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d197c1-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Puente dedicado</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d197c2-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d197c2-1c27-11ea-af09-3b2e6521927c-2-answer-2" class="radio" data-answer="incorrect"><input type="radio" name="question-2" id="question-option-id-c9d197c2-1c27-11ea-af09-3b2e6521927c-2-answer-2" aria-label="option-id-c9d197c2-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d197c2-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d197c2-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Gateway predeterminado</p></div></span></label></div><div class="form-group answer" role="group" aria-label="option-id-c9d197c3-1c27-11ea-af09-3b2e6521927c"><label for="question-option-id-c9d197c3-1c27-11ea-af09-3b2e6521927c-2-answer-3" class="radio" data-answer="incorrect"><input type="radio" name="question-2" id="question-option-id-c9d197c3-1c27-11ea-af09-3b2e6521927c-2-answer-3" aria-label="option-id-c9d197c3-1c27-11ea-af09-3b2e6521927c" value="option-id-c9d197c3-1c27-11ea-af09-3b2e6521927c" disabled=""><span class="radio__input"></span><span class="radio__label"><div id="c9d197c3-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>core switch</p></div></span></label></div></li></ol></div>


<div class="toast__message"><div id="c9d1bed1-1c27-11ea-af09-3b2e6521927c" class="text-asset undefined" style="position: relative;"><p>Identificó bien las respuestas correctas.</p><ol><li>STP se utiliza para evitar bucles de Capa 2 en LAN Ethernet.</li><li>Sin STP habilitado, las tramas de unidifusión, multidifusión y difusión desconocidas podrían hacer un bucle interminable en la red, lo que causaría un error catastrófico en la red.</li><li>El algoritmo STP elige un root bridge en la LAN. Todos los demás switches calculan la ruta de menor costo al root bridge.</li></ol></div><p>Has tenido 3 respuestas correctas de 3.</p></div>

